/*!
 * 
 *   fungsi-maju v0.0.8
 *   https://github.com/ilomon10/fungsi-maju
 * 
 *   Copyright (c) Imanuel Pundoko (https://github.com/ilomon10)
 * 
 *   This source code is licensed under the MIT license found in the
 *   LICENSE file in the root directory of this source tree.
 *   
 */
!function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define("FungsiMaju",[],t):"object"===typeof exports?exports.FungsiMaju=t():e.FungsiMaju=t()}(this,(function(){return function(e){var t={};function __webpack_require__(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,__webpack_require__),r.l=!0,r.exports}return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,n){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},__webpack_require__.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(__webpack_require__.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)__webpack_require__.d(n,r,function(t){return e[t]}.bind(null,r));return n},__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="/",__webpack_require__(__webpack_require__.s=0)}([function(e,t,n){"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.r(t),n.d(t,"Component",(function(){return r})),n.d(t,"Editor",(function(){return v})),n.d(t,"Engine",(function(){return a})),n.d(t,"Node",(function(){return s})),n.d(t,"Recursion",(function(){return i})),n.d(t,"View",(function(){return y})),n.d(t,"Area",(function(){return c})),n.d(t,"Connection",(function(){return l})),n.d(t,"Drag",(function(){return u})),n.d(t,"Element",(function(){return d})),n.d(t,"NodeView",(function(){return h})),n.d(t,"Socket",(function(){return f}));var r=function Component(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Component),_defineProperty(this,"name",null),_defineProperty(this,"engine",null),this.name=e};function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function Emitter(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Emitter),this.events=e}var e,t,n;return e=Emitter,(t=[{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];(this.events[e]||[]).forEach((function(e){return e.apply(void 0,n)}))}},{key:"on",value:function(e,t){var n=this;return(this.events[e]=this.events[e]||[]).push(t),function(){return n.events[e]=(n.events[e]||[]).filter((function(e){return e!==t}))}}}])&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Emitter}();function _createForOfIteratorHelper(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,F=function(){};return{s:F,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){a=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(a)throw o}}}}function _toConsumableArray(e){return function(e){if(Array.isArray(e))return _arrayLikeToArray(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||_unsupportedIterableToArray(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(e,t){if(e){if("string"===typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Recursion_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function Recursion(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Recursion),this.nodes=e}var e,t,n;return e=Recursion,(t=[{key:"extractInputNode",value:function(e){return this.nodes.filter((function(t){return!(t.outputs.length<1)&&-1!==t.outputs.reduce((function(e,t){return Array.isArray(t)?[].concat(_toConsumableArray(e),_toConsumableArray(t)):e})).indexOf(e.id)}))}},{key:"findSelf",value:function(e,t){var n,r=(n=t,e.filter((function(e){return-1!==n.indexOf(e)})));if(r.length)return r[0];var o,i=_createForOfIteratorHelper(t);try{for(i.s();!(o=i.n()).done;){var a=o.value,s=[a].concat(_toConsumableArray(e)),u=this.findSelf(s,this.extractInputNode(a));if(u)return u}}catch(c){i.e(c)}finally{i.f()}return null}},{key:"detect",value:function(){var e,t=_createForOfIteratorHelper(this.nodes);try{for(t.s();!(e=t.n()).done;){var n=e.value,r=this.findSelf([n],this.extractInputNode(n));if(r)return r}}catch(o){t.e(o)}finally{t.f()}return null}}])&&Recursion_defineProperties(e.prototype,t),n&&Recursion_defineProperties(e,n),Recursion}();function Engine_toConsumableArray(e){return function(e){if(Array.isArray(e))return Engine_arrayLikeToArray(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return Engine_arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Engine_arrayLikeToArray(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Engine_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _typeof(e){return(_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Engine_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_getPrototypeOf(e);if(t){var o=_getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!==typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Engine_defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}(Engine,e);var t,n,o,a=_createSuper(Engine);function Engine(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Engine),Engine_defineProperty(_assertThisInitialized(t=a.call(this,{process:[],nodecreate:[],nodecreated:[],noderemove:[],noderemoved:[]})),"version",null),Engine_defineProperty(_assertThisInitialized(t),"components",{}),Engine_defineProperty(_assertThisInitialized(t),"nodes",null),t.version=e,t}return t=Engine,(n=[{key:"register",value:function(e){if(!(e instanceof r))throw new Error("Not Valid Component");if(!e.name)throw new Error("Property name is `".concat(e.name,"`"));return e.engine=this,this.components[e.name]=e,this}},{key:"validate",value:function(e){if("object"!==_typeof(e))return!1;if(e.version!==this.version)throw new Error("Version not compatible");if(!Array.isArray(e.nodes))return!1;var t=new i(e.nodes).detect();if(t)throw new Error("Recursion detected at `".concat(t.id,"`"));return!0}},{key:"forwardProcess",value:function(e,t){var n=this;if(void 0===t)return!1;var r=this.components[e.type].worker(e,t);return e.outputs.reduce((function(e,t,o){var i=r;return Array.isArray(r)&&(i=r[o]),t.reduce((function(e,t){var r=n.nodes.find((function(e){return e.id===t}));return n.forwardProcess(r,i)}),!0)}),!0)}},{key:"process",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(n||(n={version:this.version,nodes:this.nodes}),!this.validate(n))return!1;this.nodes=Engine_toConsumableArray(n.nodes);var r=this.nodes.find((function(e){return e.id===t}));return this.forwardProcess(r,e),this.emit("process",r),!0}}])&&Engine_defineProperties(t.prototype,n),o&&Engine_defineProperties(t,o),Engine}(o);function Node_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Node_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function Node(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];Node_classCallCheck(this,Node),this.id=e,this.type=t,this.outputs=n}var e,t,n;return e=Node,(t=[{key:"addOutput",value:function(e,t){return this.outputs[e]||(this.outputs[e]=[]),t&&this.outputs[e].push(t),this}},{key:"removeOutput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=[];return n=t?this.outputs[t].filter((function(t){return t!==e})):this.outputs.map((function(t){return t.filter((function(t){return t!==e}))})),this.outputs=n,this}},{key:"toJSON",value:function(){return{id:this.id,type:this.type,outputs:this.outputs}}}])&&Node_defineProperties(e.prototype,t),n&&Node_defineProperties(e,n),Node}();function Drag_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Drag_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function Drag(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Drag_classCallCheck(this,Drag),this.pointerStart=null,this.onTranslate=t,this.onStart=n,this.down=this.down.bind(this),this.keyDown=this.keyDown.bind(this,r),this.keyUp=this.keyUp.bind(this,r),this.move=this.move.bind(this),this.up=this.up.bind(this),this.element=e,this.element.removeEventListener("pointerdown",this.down),this.element.addEventListener("pointerdown",this.down),this.keypress=null,r&&(this.keypress=!1,window.removeEventListener("keydown",this.keyDown),window.removeEventListener("keyup",this.keyUp),window.addEventListener("keydown",this.keyDown),window.addEventListener("keyup",this.keyUp)),window.removeEventListener("pointermove",this.move),window.removeEventListener("pointerup",this.up),window.addEventListener("pointermove",this.move),window.addEventListener("pointerup",this.up)}var e,t,n;return e=Drag,(t=[{key:"keyDown",value:function(e,t){t.code!==e&&t.key!==e||(this.element.style.cursor="grab",this.keypress=!0)}},{key:"keyUp",value:function(e,t){t.code!==e&&t.key!==e||(this.element.style.cursor="crosshair",this.keypress=!1)}},{key:"down",value:function(e){null!==this.keypress&&!1===this.keypress||("mouse"===e.pointerType&&e.stopPropagation(),this.pointerStart=[e.pageX,e.pageY],this.onStart(e))}},{key:"move",value:function(e){if(this.pointerStart){e.preventDefault();var t=[e.pageX,e.pageY],n=t[1],r=[t[0]-this.pointerStart[0],n-this.pointerStart[1]],o=this.element.getBoundingClientRect().width/this.element.offsetWidth;this.onTranslate(r[0]/o,r[1]/o,e)}}},{key:"up",value:function(e){this.pointerStart&&(this.pointerStart=null)}}])&&Drag_defineProperties(e.prototype,t),n&&Drag_defineProperties(e,n),Drag}();function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Area_defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Area_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function Area(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Area),this.mouse={x:0,y:0},this.element=document.createElement("div"),this.container=e,this.element.style.transformOrigin="0 0",this.background=document.createElement("div"),this.background.className="node-editor-background",this.background.style.zIndex=-1,this.container.appendChild(this.element),this.element.appendChild(this.background),this.container.addEventListener("pointermove",this.pointermove.bind(this)),this._drag=new u(this.container,this.onTranslate.bind(this),this.onStart.bind(this),"Space"),this.transform={x:0,y:0,z:1},this.update()}var e,t,n;return e=Area,(t=[{key:"pointermove",value:function(e){var t=e.clientX,n=e.clientY,r=this.element.getBoundingClientRect(),o=t-r.left,i=n-r.top,a=this.transform.z;this.mouse={x:o/a,y:i/a}}},{key:"onStart",value:function(){this._startPosition=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){Area_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.transform)}},{key:"onTranslate",value:function(e,t){this._startPosition&&this.translate(this._startPosition.x+e,this._startPosition.y+t)}},{key:"update",value:function(){var e=this.transform;this.element.style.transform="translate(".concat(e.x,"px, ").concat(e.y,"px) scale(").concat(e.z,")")}},{key:"translate",value:function(e,t){this.transform.x=e,this.transform.y=t,this.update()}},{key:"contains",value:function(e){return this.element.contains(e)}},{key:"appendChild",value:function(e){return this.element.appendChild(e)}},{key:"removeChild",value:function(e){return this.element.removeChild(e)}}])&&Area_defineProperties(e.prototype,t),n&&Area_defineProperties(e,n),Area}();function _slicedToArray(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"===typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(u){o=!0,i=u}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return Connection_arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Connection_arrayLikeToArray(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Connection_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Connection_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Connection_createClass(e,t,n){return t&&Connection_defineProperties(e.prototype,t),n&&Connection_defineProperties(e,n),e}var l=function(){function Connection(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Connection),this.view=e,this.inputSocket=n,this.outputSocket=t,this.inputSocket.addConnection(this),this.outputSocket.addConnection(this),this.element=document.createElement("div"),this.element.style.position="absolute",this.element.style.zIndex=-1,this.element.style.pointerEvents="none",this.keyup=this.keyup.bind(this),this._path=null,this.view.area.appendChild(this.element),this.render()}return Connection_createClass(Connection,null,[{key:"defaultPath",value:function(e){var t=_slicedToArray(e,4),n=t[0],r=t[1],o=t[2],i=t[3],a=(n+o)/2;a-=a-n;var s=(r+i)/2,u=(n+o)/2;u+=u-n;var c=(r+i)/2;return"M ".concat(n," ").concat(r," C ").concat(a," ").concat(s," ").concat(u," ").concat(c," ").concat(o," ").concat(i)}},{key:"renderPathData",value:function(e){return Connection.defaultPath(e)}},{key:"updateConnection",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(n||(n=e.querySelector(".connection path.main-path")),!n)throw new Error("Path of connection was broken");n.setAttribute("d",t)}},{key:"renderConnection",value:function(e,t,n){var r=document.createElementNS("http://www.w3.org/2000/svg","svg"),o=document.createElementNS("http://www.w3.org/2000/svg","path"),i=n?["input-".concat(n.inputId),"output-".concat(n.outputId)]:[];return i.length>0?r.classList.add("connection",i):r.classList.add("connection"),o.classList.add("main-path"),o.style.pointerEvents="all",o.setAttribute("d",t),r.appendChild(o),e.appendChild(r),o}}]),Connection_createClass(Connection,[{key:"getPoints",value:function(){var e=_slicedToArray(this.outputSocket.getPosition(),2),t=e[0],n=e[1],r=_slicedToArray(this.inputSocket.getPosition(),2);return[t,n,r[0],r[1]]}},{key:"update",value:function(){var e=Connection.renderPathData(this.getPoints());Connection.updateConnection(this.element,e,this._path)}},{key:"render",value:function(){var e=Connection.renderPathData(this.getPoints());this._path=Connection.renderConnection(this.element,e,{inputId:this.inputSocket.nodeView.node.id,outputId:this.outputSocket.nodeView.node.id}),this._path.removeEventListener("click",this.click.bind(this)),this._path.addEventListener("click",this.click.bind(this))}},{key:"click",value:function(e){console.log("click");var t=this._path.classList;window.removeEventListener("keyup",this.keyup),t.contains("active")||window.addEventListener("keyup",this.keyup),t.toggle("active")}},{key:"keyup",value:function(e){"Delete"!==e.code&&"Backspace"!==e.code||this.destroy()}},{key:"destroy",value:function(){window.removeEventListener("keyup",this.keyup),this.inputSocket.removeConnection(this),this.outputSocket.removeConnection(this),this.view.removeConnection(this)}}]),Connection}();function Socket_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f=function(){function Socket(e,t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Socket),this.element=e,this.branch=t,this.type=n,this.nodeView=r,this.connection=[],this.element.removeEventListener("pointerdown",this.pointerdown.bind(this)),this.element.addEventListener("pointerdown",this.pointerdown.bind(this)),this._pick=!1}var e,t,n;return e=Socket,(t=[{key:"action",value:function(e){var t=this.nodeView.view.picker;if(!e)return t.reset(),!1;"input"===e.type?t.pickInput(this):"output"===e.type&&t.pickOutput(this)}},{key:"pointerdown",value:function(e){console.log("socket"),this.nodeView.view.container.dispatchEvent(new PointerEvent("mousemove",e)),this.action(this),e.preventDefault(),e.stopPropagation()}},{key:"hasConnection",value:function(e){var t=this.connection.find((function(t){return t.inputSocket===e||t.outputSocket===e}));return e?!!t:this.connection.length>0}},{key:"addConnection",value:function(e){this.connection.push(e)}},{key:"removeConnection",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null===t)return this.connection.map((function(t){return e.removeConnection(t).destroy(),t}));var n=this.connection.indexOf(t),r=this.connection.splice(n,1);return r[0]}},{key:"getPosition",value:function(){var e=this.element,t=this.nodeView.node,n=e.offsetWidth/2,r=e.offsetHeight/2;return[t.position[0]+e.offsetLeft+n,t.position[1]+e.offsetTop+r]}},{key:"destroy",value:function(){this.removeConnection()}}])&&Socket_defineProperties(e.prototype,t),n&&Socket_defineProperties(e,n),Socket}();function Element_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function Element(e,t){var n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Element),o={input:{},output:{}},(r="sockets")in(n=this)?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,this.nodeView=e,this.element=document.createElement("div"),this.content=document.createElement("div"),this.input=document.createElement("div"),this.output=document.createElement("div"),this.element.setAttribute("class","node"),this.input.setAttribute("class","node-input"),this.output.setAttribute("class","node-output"),this.content.setAttribute("class","node-content"),this.content.innerHTML=t||"",this.element.appendChild(this.content),this.element.appendChild(this.input),this.element.appendChild(this.output)}var e,t,n;return e=Element,(t=[{key:"addSocket",value:function(e,t,n){var r=document.createElement("div");r.setAttribute("class","node-socket-".concat(t));var o=document.createElement("div");r.appendChild(o),o.innerHTML=n||t;var i={name:n,element:r};return"input"!==e&&"output"!==e||(this.sockets[e][t]=i),i}},{key:"render",value:function(e,t){e.selected[t.id]?this.element.classList.add("selected"):this.element.classList.remove("selected");for(var n=0,r=Object.keys(this.sockets);n<r.length;n++)for(var o=r[n],i=0,a=Object.keys(this.sockets[o]);i<a.length;i++){var s=a[i],u=this.sockets[o][s];switch(o){case"input":this.input.appendChild(u.element);break;case"output":this.output.appendChild(u.element)}}return this.element}}])&&Element_defineProperties(e.prototype,t),n&&Element_defineProperties(e,n),Element}();function Node_slicedToArray(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"===typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(u){o=!0,i=u}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||Node_unsupportedIterableToArray(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Node_toConsumableArray(e){return function(e){if(Array.isArray(e))return Node_arrayLikeToArray(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Node_unsupportedIterableToArray(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Node_unsupportedIterableToArray(e,t){if(e){if("string"===typeof e)return Node_arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Node_arrayLikeToArray(e,t):void 0}}function Node_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function View_Node_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h=function(){function Node(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Node),this.view=n,this.node=e,this.sockets={},this.component=t,this.container=document.createElement("div"),this.container.style.position="absolute",this.container.className="node-wrapper",this.element=new d(this,this.component.name),this._drag=new u(this.container,this.onTranslate.bind(this),this.onStart.bind(this)),this.update(),this.render()}var e,t,n;return e=Node,(t=[{key:"getElement",value:function(){return this.element.element}},{key:"addSocket",value:function(e,t,n){var r=this.element.addSocket(e,t,n);return this.sockets["".concat(e,"-").concat(t)]=new f(r.element,t,e,this),"output"===e&&this.node.addOutput(t),this.update(),r}},{key:"getSocket",value:function(e,t){var n=this.sockets["".concat(e,"-").concat(t)];if(!n)throw new Error("Socket ".concat(e," ").concat(t," at node `").concat(this.id,"` not found."));return n}},{key:"onStart",value:function(e){this.view.selectNode(this,e.ctrlKey),this._startPosition=Node_toConsumableArray(this.node.position)}},{key:"onTranslate",value:function(e,t){var n=this._startPosition[0]+e,r=this._startPosition[1]+t;this.translate(n,r)}},{key:"onDrag",value:function(e,t){var n=this._startPosition[0]+e,r=this._startPosition[1]+t;this.translate(n,r)}},{key:"translate",value:function(e,t){var n=this.node,r=e,o=t;n.position[0]=5*Math.floor(r/5),n.position[1]=5*Math.floor(o/5),this.update()}},{key:"update",value:function(){var e=0,t=0;if(this.node.position){var n=Node_slicedToArray(this.node.position,2);e=n[0],t=n[1]}this.container.style.transform="translate(".concat(e,"px, ").concat(t,"px)"),this.node.position=[e,t],this.view.rerenderNode()}},{key:"render",value:function(){var e=this.element.render(this.view,this.node);this.container.appendChild(e)}},{key:"destroy",value:function(){var e=this;Object.keys(this.sockets).forEach((function(t){var n=e.sockets[t];console.log(n),n.destroy()})),this.view.area.removeChild(this.container)}},{key:"toJSON",value:function(){return this.node.toJSON()}},{key:"id",get:function(){return this.node.id}}])&&View_Node_defineProperties(e.prototype,t),n&&View_Node_defineProperties(e,n),Node}();function Picker_slicedToArray(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"===typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(u){o=!0,i=u}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return Picker_arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Picker_arrayLikeToArray(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Picker_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Picker_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function Picker(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Picker),this.view=e,this.element=document.createElement("div"),this.element.style.position="absolute",this.element.classList.add("node-picker"),this.view.area.appendChild(this.element),this._socket=null,this.view.container.addEventListener("pointermove",(function(){return t.socket&&t.updateConnection(t.socket)})),this.pointerup=this.pointerup.bind(this),window.removeEventListener("pointerup",this.pointerup),window.addEventListener("pointerup",this.pointerup)}var e,t,n;return e=Picker,(t=[{key:"reset",value:function(){this.socket=null}},{key:"pointerup",value:function(e){var t=document.elementFromPoint(e.clientX,e.clientY);if(!this.view.container.contains(t))return this.reset(),!1;var n=this.view.getSockets().find((function(e){return e.element===t}));if(!this.socket||!n)return this.reset(),!1;n&&n.action(n)}},{key:"pickOutput",value:function(e){return null===this.socket&&e?(this.socket=e,!0):"input"===this.socket.type?(this.socket.hasConnection(e)||this.view.connect(this.socket,e),this.reset(),!0):void(e&&(this.socket=e))}},{key:"pickInput",value:function(e){return null===this.socket?(this.socket=e,!0):"output"===this.socket.type?(this.socket.hasConnection(e)||this.view.connect(e,this.socket),this.reset(),!0):void(e&&(this.socket=e))}},{key:"getPoints",value:function(e){var t=this.view.area.mouse,n=Picker_slicedToArray(e.getPosition(),2),r=n[0],o=n[1];return"output"===e.type?[r,o,t.x,t.y]:[t.x,t.y,r,o]}},{key:"updatePseudoConnection",value:function(e){null!==e?this.renderConnection(e):this.element.innerHTML=""}},{key:"updateConnection",value:function(e){var t=l.renderPathData(this.getPoints(e));l.updateConnection(this.element,t)}},{key:"renderConnection",value:function(e){var t=l.renderPathData(this.getPoints(e));l.renderConnection(this.element,t)}},{key:"socket",get:function(){return this._socket},set:function(e){return this._socket=e,this.updatePseudoConnection(e),e}}])&&Picker_defineProperties(e.prototype,t),n&&Picker_defineProperties(e,n),Picker}();function View_toConsumableArray(e){return function(e){if(Array.isArray(e))return View_arrayLikeToArray(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return View_arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return View_arrayLikeToArray(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function View_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function View_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var y=function(){function View(e,t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,View),this.emitter=n,this.container=e,this.components=t,this.container.classList.add("node-editor-container"),this.container.addEventListener("click",this.click.bind(this)),this.container.style.cursor="crosshair",this.keyup=this.keyup.bind(this),window.removeEventListener("keyup",this.keyup),window.addEventListener("keyup",this.keyup),this.connection={},this.selected={},this.nodes={},this.area=new c(this.container),this.picker=new p(this),this.emitter.on("nodecreated",(function(e,t){var n=r.addNode(e);t.builder(n)}))}var e,t,n;return e=View,(t=[{key:"addNode",value:function(e){var t=this.components[e.type];if(!t)throw new Error("Component ".concat(e.name," not found"));var n=new h(e,t,this);return this.nodes[e.id]=n,this.area.appendChild(n.container),n}},{key:"selectNode",value:function(e,t){if(e&&!this.nodes[e.id])throw new Error("Node not exist in list");t||(this.selected={}),this.selected[e.id]?delete this.selected[e.id]:this.selected[e.id]=e,this.rerenderNode()}},{key:"removeNode",value:function(e){var t=this,n=Object.keys(this.nodes).filter((function(n){return t.nodes[n]===e})),r=this.nodes[n].node;return this.nodes[n].destroy(),delete this.nodes[n],this.emitter.removeNode(n),r}},{key:"addConnection",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=this.nodes[e.id],i=this.nodes[n.id],a=o.getSocket("output",t),s=i.getSocket("input",r);this.connect(a,s)}},{key:"removeConnection",value:function(e){var t=this,n=Object.keys(this.connection).filter((function(n){return t.connection[n]===e}));this.area.removeChild(this.connection[n].element),delete this.connection[n]}},{key:"connect",value:function(e,t){var n=e.nodeView,r=t.nodeView,o="".concat(n.id,"_").concat(e.branch,"-").concat(r.id,"_").concat(t.branch);this.connection[o]=new l(this,e,t)}},{key:"getSockets",value:function(){var e=this;return Object.keys(this.nodes).map((function(t){return e.nodes[t].sockets})).map((function(e){return Object.keys(e).map((function(t){return e[t]}))})).reduce((function(e,t){return[].concat(View_toConsumableArray(e),View_toConsumableArray(t))}),[])}},{key:"rerenderNode",value:function(){var e=this;Object.keys(this.nodes).forEach((function(t){e.nodes[t].render()})),Object.keys(this.connection).forEach((function(t){e.connection[t].update()}))}},{key:"click",value:function(e){var t=this,n=!1;Object.keys(this.nodes).forEach((function(r){t.nodes[r].getElement().contains(e.target)&&(n=!0)})),n||(this.selected={},this.rerenderNode())}},{key:"keyup",value:function(e){var t=this;"Backspace"!==e.code&&"Delete"!==e.code||(console.log("delete",this.selected),Object.keys(this.selected).forEach((function(e){var n=t.selected[e];t.removeNode(n)})))}}])&&View_defineProperties(e.prototype,t),n&&View_defineProperties(e,n),View}();function Editor_typeof(e){return(Editor_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Editor_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Editor_createClass(e,t,n){return t&&Editor_defineProperties(e.prototype,t),n&&Editor_defineProperties(e,n),e}function Editor_setPrototypeOf(e,t){return(Editor_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Editor_createSuper(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Editor_getPrototypeOf(e);if(t){var o=Editor_getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Editor_possibleConstructorReturn(this,n)}}function Editor_possibleConstructorReturn(e,t){return!t||"object"!==Editor_typeof(t)&&"function"!==typeof t?Editor_assertThisInitialized(e):t}function Editor_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Editor_getPrototypeOf(e){return(Editor_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Editor_setPrototypeOf(e,t)}(Editor,e);var t=Editor_createSuper(Editor);function Editor(e,n){var r,o,i,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Editor),r=t.call(this,e),o=Editor_assertThisInitialized(r),a=null,(i="view")in o?Object.defineProperty(o,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[i]=a,r.nodes=[],n&&(r.view=new y(n,r.components,Editor_assertThisInitialized(r))),r}return Editor_createClass(Editor,null,[{key:"generateId",value:function(){var e=Math.random().toString(36);return"".concat(e.substr(2,4),"_").concat(e.substr(4,4))}}]),Editor_createClass(Editor,[{key:"addNode",value:function(e){if(this.emit("nodecreate",e),!e instanceof s)return e;if(!this.components.hasOwnProperty(e.type))throw new Error("Component ".concat(e.type," not registered"));return this.nodes.push(e),this.emit("nodecreated",e,this.components[e.type]),e}},{key:"removeNode",value:function(e){var t=this;if(Array.isArray(e))return e.map((function(e){return t.removeNode(e)}));this.emit("noderemove",this.nodes);var n=this.nodes.findIndex((function(t){return t.id===e}));if(-1===n)throw new Error("Node ".concat(e," not found"));var r=this.nodes.splice(n,1);return this.emit("noderemoved",r),r}},{key:"connect",value:function(e,t,n){var r=this.nodes.find((function(t){return t.id===e.id}));if(!r)throw new Error("Node ".concat(e.id," not found"));var o=this.nodes.find((function(e){return e.id===n.id}));if(!o)throw new Error("Node ".concat(n.id," not found"));return this.view&&this.view.addConnection(r,t,o),r.addOutput(t,o.id),this}},{key:"toJSON",value:function(){return{version:this.version,nodes:this.nodes.map((function(e){return e.toJSON()}))}}}]),Editor}(a);t.default={Component:r,Editor:v,Engine:a,Node:s,Recursion:i,View:y,Area:c,Connection:l,Drag:u,NodeView:h,Element:d,Socket:f}}])}));
//# sourceMappingURL=index.js.map